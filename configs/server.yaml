# BlazeLog Server Configuration
#
# This is an example configuration file for the BlazeLog server.
# Copy and modify as needed.

server:
  # gRPC listen address for agent connections
  grpc_address: ":9443"

  # HTTP listen address for REST API and Web UI
  http_address: ":8080"

  # Explicitly allow non-TLS mode (development only)
  allow_insecure: true

  # TLS configuration for mTLS (mutual TLS)
  # Generate certificates with: blazelog ca init && blazelog cert server
  tls:
    # Enable mTLS (set to false for insecure mode during development)
    enabled: false

    # Server certificate file
    # cert_file: "/etc/blazelog/certs/server.crt"

    # Server private key file
    # key_file: "/etc/blazelog/certs/server.key"

    # CA certificate for verifying client certificates
    # client_ca_file: "/etc/blazelog/certs/ca.crt"
metrics:
  enabled: false

api:
  # Safety limits for query/stream endpoints
  max_query_range: "24h"
  query_timeout: "10s"
  stream_max_duration: "30m"
  stream_poll_interval: "1s"

# Database configuration
# NOTE: BLAZELOG_MASTER_KEY environment variable is REQUIRED
# This key is used to encrypt sensitive data (connection credentials)
# Generate a secure key: openssl rand -base64 32
database:
  # SQLite database file path
  # Default: ./data/blazelog.db
  path: "./data/blazelog.db"

# Authentication configuration
# NOTE: Set these environment variables to enable JWT and Web UI
# Generate secrets with: openssl rand -base64 32
auth:
  # JWT secret for REST API authentication
  jwt_secret_env: "BLAZELOG_JWT_SECRET"
  # CSRF secret for Web UI (if empty, web UI is disabled)
  csrf_secret_env: "BLAZELOG_CSRF_SECRET"

# SSH security settings
ssh:
  # Host key verification file (OpenSSH known_hosts format)
  # Default: /etc/blazelog/known_hosts (server) or ~/.blazelog/known_hosts (agent)
  host_key_file: "/etc/blazelog/known_hosts"

  # Host key verification policy:
  #   strict - reject unknown hosts (most secure, requires pre-configured known_hosts)
  #   tofu   - trust on first use, reject on key change (balanced, default)
  #   warn   - accept all, log warnings (dev only, not recommended for production)
  host_key_policy: "tofu"

  # Audit log for SSH operations (JSON lines format)
  # Records: connections, disconnections, host key events, commands, file operations
  audit_log: "/var/log/blazelog/ssh-audit.log"

  # Connection pool settings
  pool:
    # Maximum connections per host
    max_per_host: 5
    # Close idle connections after this duration
    idle_timeout: 5m

# SSH connections for remote log collection (agentless mode)
# Uncomment and configure to pull logs from remote servers via SSH
# ssh_connections:
#   - name: "web-server-1"
#     host: "web1.example.com:22"
#     user: "blazelog"
#     # Key file - use .enc suffix for encrypted keys (requires master_password)
#     key_file: "/etc/blazelog/ssh/web1.key"
#     # key_passphrase: ""  # Optional passphrase for encrypted SSH keys
#     sources:
#       - path: "/var/log/nginx/access.log"
#         type: "nginx"
#         follow: true
#       - path: "/var/log/nginx/error.log"
#         type: "nginx"
#         follow: true
#
#   - name: "magento-server"
#     host: "magento.example.com:22"
#     user: "blazelog"
#     key_file: "/etc/blazelog/ssh/magento.key"
#     sources:
#       - path: "/var/www/magento/var/log/system.log"
#         type: "magento"
#         follow: true
#       - path: "/var/www/magento/var/log/exception.log"
#         type: "magento"
#         follow: true
#
#   - name: "internal-server"
#     host: "internal.example.com:22"
#     user: "blazelog"
#     # Encrypted key file (requires BLAZELOG_MASTER_KEY env var or master_password)
#     key_file: "/etc/blazelog/ssh/internal.key.enc"
#     # Jump host / bastion for reaching internal servers
#     jump_host:
#       host: "bastion.example.com:22"
#       user: "blazelog"
#       key_file: "/etc/blazelog/ssh/bastion.key"
#     sources:
#       - path: "/var/log/app/*.log"
#         type: "auto"
#         follow: true
