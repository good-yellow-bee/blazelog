# Docker Compose Override for Local Development
#
# This file is automatically loaded by docker compose.
# It adds development-specific configurations.
#
# To disable: rename or delete this file
# To use production settings only: docker compose -f docker-compose.yml up

services:
  server:
    # Use local build instead of pulling image
    build:
      context: ../..
      dockerfile: deployments/docker/Dockerfile.server
    # Mount dev config for development
    volumes:
      - blazelog-data:/data
      - ./config/server-dev.yaml:/etc/blazelog/server.yaml:rw
      - blazelog-certs:/etc/blazelog/certs:ro
      - blazelog-ssh:/etc/blazelog/ssh:ro
      - ./config/known_hosts:/etc/blazelog/known_hosts:rw
    # Enable verbose logging
    command: ["-c", "/etc/blazelog/server.yaml", "-v"]
    # Faster health check for dev
    healthcheck:
      interval: 10s
      start_period: 5s
    # Wait for ClickHouse in dev
    depends_on:
      clickhouse:
        condition: service_healthy
