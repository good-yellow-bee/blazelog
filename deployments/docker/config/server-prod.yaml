# BlazeLog Server Configuration for Docker Production
#
# This config enables ClickHouse for log storage.
# Use with: docker compose --profile prod up -d

server:
  grpc_address: ":9443"
  http_address: ":8080"
  allow_insecure: false

  # Enable mTLS for production
  tls:
    enabled: true
    cert_file: "/etc/blazelog/certs/server.crt"
    key_file: "/etc/blazelog/certs/server.key"
    client_ca_file: "/etc/blazelog/certs/ca.crt"
  http_tls:
    enabled: true
    cert_file: "/etc/blazelog/certs/server.crt"
    key_file: "/etc/blazelog/certs/server.key"

# Database configuration
database:
  path: "/data/blazelog.db"

# Authentication configuration
auth:
  jwt_secret_env: "BLAZELOG_JWT_SECRET"
  csrf_secret_env: "BLAZELOG_CSRF_SECRET"
  access_token_ttl: "15m"
  refresh_token_ttl: "168h"  # 7 days
  rate_limit_per_ip: 100
  rate_limit_per_user: 1000
  lockout_threshold: 5
  lockout_duration: "15m"
  use_secure_cookies: true

api:
  max_query_range: "24h"
  query_timeout: "10s"
  stream_max_duration: "30m"
  stream_poll_interval: "1s"

# SSH security settings
ssh:
  host_key_file: "/etc/blazelog/known_hosts"
  host_key_policy: "strict"
  audit_log: "/data/ssh-audit.log"
  pool:
    max_per_host: 5
    idle_timeout: 5m

# Metrics configuration
metrics:
  enabled: true
  address: ":9090"

# ClickHouse configuration - ENABLED for production
clickhouse:
  enabled: true
  addresses:
    - "clickhouse:9000"
  database: "blazelog"
  username: "blazelog"
  password_env: "CLICKHOUSE_PASSWORD"
  batch_size: 10000
  flush_interval: "5s"
  max_buffer_size: 100000
  max_open_conns: 10
  retention_days: 90
