openapi: "3.0.3"
info:
  title: Blazelog API
  version: "1.0.0"
  description: Log aggregation and alerting platform REST API with JWT authentication
  contact:
    name: Blazelog Team

servers:
  - url: http://localhost:8080
    description: Local development
  - url: https://api.blazelog.io
    description: Production

security:
  - bearerAuth: []

tags:
  - name: Auth
    description: Authentication and token management
  - name: Users
    description: User management
  - name: Logs
    description: Log query and streaming
  - name: Alerts
    description: Alert rules and history
  - name: Projects
    description: Project management
  - name: Connections
    description: SSH connection management

paths:
  # ==================== Auth ====================
  /api/v1/auth/login:
    post:
      tags: [Auth]
      summary: Login with username and password
      description: Authenticate user and receive access and refresh tokens
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  example: admin
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/AccountLocked'

  /api/v1/auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      description: Use refresh token to obtain new access and refresh tokens
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refresh_token]
              properties:
                refresh_token:
                  type: string
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Token refresh successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/auth/logout:
    post:
      tags: [Auth]
      summary: Logout and revoke refresh token
      description: Revoke the provided refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refresh_token]
              properties:
                refresh_token:
                  type: string
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '204':
          description: Logout successful
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ==================== Users ====================
  /api/v1/users/me:
    get:
      tags: [Users]
      summary: Get current user
      description: Retrieve authenticated user information
      responses:
        '200':
          description: User information
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/users/me/password:
    put:
      tags: [Users]
      summary: Change password
      description: Change current user's password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [current_password, new_password]
              properties:
                current_password:
                  type: string
                  format: password
                new_password:
                  type: string
                  format: password
                  minLength: 8
      responses:
        '204':
          description: Password changed successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/users:
    get:
      tags: [Users]
      summary: List users
      description: List all users (admin only)
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

    post:
      tags: [Users]
      summary: Create user
      description: Create a new user (admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, email, password, role]
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 50
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                  minLength: 8
                role:
                  type: string
                  enum: [admin, operator, viewer]
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/v1/users/{id}:
    get:
      tags: [Users]
      summary: Get user by ID
      description: Retrieve user by ID (admin or self)
      parameters:
        - $ref: '#/components/parameters/UserID'
      responses:
        '200':
          description: User information
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Users]
      summary: Update user
      description: Update user (admin or self, role change admin only)
      parameters:
        - $ref: '#/components/parameters/UserID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: [admin, operator, viewer]
                  description: Admin only
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

    delete:
      tags: [Users]
      summary: Delete user
      description: Delete user (admin only)
      parameters:
        - $ref: '#/components/parameters/UserID'
      responses:
        '204':
          description: User deleted
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/users/{id}/password:
    put:
      tags: [Users]
      summary: Reset user password (admin only)
      description: |
        Admin can reset password for non-admin users only.
        Cannot reset other admin passwords.
        Invalidates all existing sessions and tokens for the user.
      parameters:
        - $ref: '#/components/parameters/UserID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [password]
              properties:
                password:
                  type: string
                  format: password
                  minLength: 8
      responses:
        '204':
          description: Password reset successfully, all sessions invalidated
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Cannot reset admin password or own password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                admin_target:
                  summary: Target user is admin
                  value:
                    error:
                      code: FORBIDDEN
                      message: cannot reset admin password
                self_target:
                  summary: Cannot reset own password
                  value:
                    error:
                      code: FORBIDDEN
                      message: use change password endpoint for own password
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== Logs ====================
  /api/v1/logs:
    get:
      tags: [Logs]
      summary: Query logs
      description: Query logs with filters and pagination
      parameters:
        - name: start
          in: query
          required: true
          schema:
            type: string
            format: date-time
          description: Start time (RFC3339)
          example: "2024-01-01T00:00:00Z"
        - name: end
          in: query
          schema:
            type: string
            format: date-time
          description: End time (RFC3339, default now)
          example: "2024-01-02T00:00:00Z"
        - name: agent_id
          in: query
          schema:
            type: string
        - name: level
          in: query
          schema:
            type: string
            enum: [debug, info, warning, error, fatal]
        - name: levels
          in: query
          schema:
            type: string
          description: Comma-separated levels
          example: "error,fatal"
        - name: type
          in: query
          schema:
            type: string
        - name: source
          in: query
          schema:
            type: string
        - name: file_path
          in: query
          schema:
            type: string
        - name: q
          in: query
          schema:
            type: string
          description: Message search query
        - name: search_mode
          in: query
          schema:
            type: string
            enum: [token, substring, phrase]
            default: token
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 50
        - name: order
          in: query
          schema:
            type: string
            enum: [timestamp, level]
            default: timestamp
        - name: order_dir
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Log query results
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/LogsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/logs/stats:
    get:
      tags: [Logs]
      summary: Get log statistics
      description: Retrieve aggregated log statistics
      parameters:
        - name: start
          in: query
          required: true
          schema:
            type: string
            format: date-time
        - name: end
          in: query
          schema:
            type: string
            format: date-time
        - name: agent_id
          in: query
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
        - name: interval
          in: query
          schema:
            type: string
            enum: [minute, hour, day]
            default: hour
      responses:
        '200':
          description: Log statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/StatsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/logs/stream:
    get:
      tags: [Logs]
      summary: Stream logs via SSE
      description: Server-Sent Events stream of matching logs
      parameters:
        - name: start
          in: query
          schema:
            type: string
            format: date-time
          description: Start time (default last 5 minutes)
        - name: agent_id
          in: query
          schema:
            type: string
        - name: level
          in: query
          schema:
            type: string
        - name: levels
          in: query
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
        - name: source
          in: query
          schema:
            type: string
        - name: q
          in: query
          schema:
            type: string
        - name: search_mode
          in: query
          schema:
            type: string
            enum: [token, substring, phrase]
            default: token
      responses:
        '200':
          description: SSE stream
          content:
            text/event-stream:
              schema:
                type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ==================== Alerts ====================
  /api/v1/alerts:
    get:
      tags: [Alerts]
      summary: List alerts
      description: List all alert rules
      parameters:
        - name: project_id
          in: query
          schema:
            type: string
          description: Filter by project
      responses:
        '200':
          description: List of alerts
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Alert'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Alerts]
      summary: Create alert
      description: Create new alert rule (admin/operator)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlertCreate'
      responses:
        '201':
          description: Alert created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Alert'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /api/v1/alerts/history:
    get:
      tags: [Alerts]
      summary: Get alert history
      description: Retrieve alert trigger history with pagination
      parameters:
        - name: alert_id
          in: query
          schema:
            type: string
        - name: project_id
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        '200':
          description: Alert history
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/AlertHistoryList'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/alerts/{id}:
    get:
      tags: [Alerts]
      summary: Get alert by ID
      parameters:
        - $ref: '#/components/parameters/AlertID'
      responses:
        '200':
          description: Alert details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Alert'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Alerts]
      summary: Update alert
      description: Update alert rule (admin/operator)
      parameters:
        - $ref: '#/components/parameters/AlertID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlertUpdate'
      responses:
        '200':
          description: Alert updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Alert'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Alerts]
      summary: Delete alert
      description: Delete alert rule (admin only)
      parameters:
        - $ref: '#/components/parameters/AlertID'
      responses:
        '204':
          description: Alert deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== Projects ====================
  /api/v1/projects:
    get:
      tags: [Projects]
      summary: List projects
      description: List all projects (admin sees all, others see assigned)
      responses:
        '200':
          description: List of projects
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Project'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Projects]
      summary: Create project
      description: Create new project (admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 3
                  maxLength: 100
                description:
                  type: string
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/v1/projects/{id}:
    get:
      tags: [Projects]
      summary: Get project by ID
      parameters:
        - $ref: '#/components/parameters/ProjectID'
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Project'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Projects]
      summary: Update project
      description: Update project (admin only)
      parameters:
        - $ref: '#/components/parameters/ProjectID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: Project updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

    delete:
      tags: [Projects]
      summary: Delete project
      description: Delete project (admin only)
      parameters:
        - $ref: '#/components/parameters/ProjectID'
      responses:
        '204':
          description: Project deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/projects/{id}/users:
    get:
      tags: [Projects]
      summary: Get project users
      parameters:
        - $ref: '#/components/parameters/ProjectID'
      responses:
        '200':
          description: List of project users
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProjectUser'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags: [Projects]
      summary: Add user to project
      description: Add user to project (admin only)
      parameters:
        - $ref: '#/components/parameters/ProjectID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_id]
              properties:
                user_id:
                  type: string
                role:
                  type: string
                  enum: [admin, operator, viewer]
                  default: viewer
      responses:
        '204':
          description: User added to project
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/projects/{id}/users/{userId}:
    delete:
      tags: [Projects]
      summary: Remove user from project
      description: Remove user from project (admin only)
      parameters:
        - $ref: '#/components/parameters/ProjectID'
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: User removed from project
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== Connections ====================
  /api/v1/connections:
    get:
      tags: [Connections]
      summary: List connections
      parameters:
        - name: project_id
          in: query
          schema:
            type: string
          description: Filter by project
      responses:
        '200':
          description: List of connections
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Connection'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Connections]
      summary: Create connection
      description: Create new connection (admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConnectionCreate'
      responses:
        '201':
          description: Connection created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Connection'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/v1/connections/{id}:
    get:
      tags: [Connections]
      summary: Get connection by ID
      parameters:
        - $ref: '#/components/parameters/ConnectionID'
      responses:
        '200':
          description: Connection details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Connection'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Connections]
      summary: Update connection
      description: Update connection (admin only)
      parameters:
        - $ref: '#/components/parameters/ConnectionID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConnectionUpdate'
      responses:
        '200':
          description: Connection updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Connection'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

    delete:
      tags: [Connections]
      summary: Delete connection
      description: Delete connection (admin only)
      parameters:
        - $ref: '#/components/parameters/ConnectionID'
      responses:
        '204':
          description: Connection deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/connections/{id}/test:
    post:
      tags: [Connections]
      summary: Test connection
      description: Test SSH connection (admin only)
      parameters:
        - $ref: '#/components/parameters/ConnectionID'
      responses:
        '200':
          description: Test result
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
                      message:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== Health ====================
  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Check API health status
      security: []
      responses:
        '200':
          description: Healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  /health/live:
    get:
      tags: [Health]
      summary: Liveness probe
      description: Kubernetes liveness check - returns 200 if process is running
      security: []
      responses:
        '200':
          description: Alive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  /health/ready:
    get:
      tags: [Health]
      summary: Readiness probe
      description: Kubernetes readiness check - returns 200 if ready to serve traffic
      security: []
      responses:
        '200':
          description: Ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token from /api/v1/auth/login

  parameters:
    UserID:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    AlertID:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    ProjectID:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    ConnectionID:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid

  schemas:
    # Auth schemas
    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
          description: JWT access token
        refresh_token:
          type: string
          description: Refresh token
        expires_in:
          type: integer
          description: Access token TTL in seconds
        token_type:
          type: string
          example: Bearer

    # User schemas
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [admin, operator, viewer]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Log schemas
    Log:
      type: object
      properties:
        id:
          type: string
        timestamp:
          type: string
          format: date-time
        level:
          type: string
          enum: [debug, info, warning, error, fatal]
        message:
          type: string
        source:
          type: string
        type:
          type: string
        agent_id:
          type: string
        file_path:
          type: string
        line_number:
          type: integer
        fields:
          type: object
          additionalProperties: true
        labels:
          type: object
          additionalProperties:
            type: string
        http_status:
          type: integer
        http_method:
          type: string
        uri:
          type: string

    LogsResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Log'
        total:
          type: integer
        page:
          type: integer
        per_page:
          type: integer
        total_pages:
          type: integer

    StatsResponse:
      type: object
      properties:
        error_rates:
          type: object
          properties:
            total_logs:
              type: integer
            error_count:
              type: integer
            warning_count:
              type: integer
            fatal_count:
              type: integer
            error_rate:
              type: number
              format: float
        top_sources:
          type: array
          items:
            type: object
            properties:
              source:
                type: string
              count:
                type: integer
              error_count:
                type: integer
        volume:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              total_count:
                type: integer
              error_count:
                type: integer
        http_stats:
          type: object
          properties:
            total_2xx:
              type: integer
            total_3xx:
              type: integer
            total_4xx:
              type: integer
            total_5xx:
              type: integer
            top_uris:
              type: array
              items:
                type: object
                properties:
                  uri:
                    type: string
                  count:
                    type: integer

    # Alert schemas
    Alert:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [error_rate, log_match, threshold]
        condition:
          type: string
          description: Alert condition expression
        severity:
          type: string
          enum: [info, warning, critical]
        window:
          type: string
          description: Time window duration (e.g., "5m", "1h")
        cooldown:
          type: string
          description: Cooldown duration (e.g., "10m", "1h")
        notify:
          type: array
          items:
            type: string
          description: Notification channel names
        enabled:
          type: boolean
        project_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    AlertCreate:
      type: object
      required: [name, type, condition, severity, window, cooldown, enabled]
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
        description:
          type: string
        type:
          type: string
          enum: [error_rate, log_match, threshold]
        condition:
          type: string
        severity:
          type: string
          enum: [info, warning, critical]
        window:
          type: string
          example: "5m"
        cooldown:
          type: string
          example: "10m"
        notify:
          type: array
          items:
            type: string
          default: []
        enabled:
          type: boolean
        project_id:
          type: string
          format: uuid

    AlertUpdate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [error_rate, log_match, threshold]
        condition:
          type: string
        severity:
          type: string
          enum: [info, warning, critical]
        window:
          type: string
        cooldown:
          type: string
        notify:
          type: array
          items:
            type: string
        enabled:
          type: boolean
        project_id:
          type: string

    AlertHistory:
      type: object
      properties:
        id:
          type: string
          format: uuid
        alert_id:
          type: string
          format: uuid
        alert_name:
          type: string
        severity:
          type: string
          enum: [info, warning, critical]
        message:
          type: string
        matched_logs:
          type: integer
        notified_at:
          type: string
          format: date-time
        project_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time

    AlertHistoryList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AlertHistory'
        total:
          type: integer
        page:
          type: integer
        per_page:
          type: integer

    # Project schemas
    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ProjectUser:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [admin, operator, viewer]

    # Connection schemas
    Connection:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [ssh]
        host:
          type: string
        port:
          type: integer
        user:
          type: string
        status:
          type: string
          enum: [unknown, connected, disconnected, error]
        last_tested_at:
          type: string
          format: date-time
          nullable: true
        project_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ConnectionCreate:
      type: object
      required: [name, type, host, user]
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
        type:
          type: string
          enum: [ssh]
        host:
          type: string
          description: Hostname or IP address
        port:
          type: integer
          default: 22
          minimum: 1
          maximum: 65535
        user:
          type: string
        project_id:
          type: string
          format: uuid

    ConnectionUpdate:
      type: object
      properties:
        name:
          type: string
        host:
          type: string
        port:
          type: integer
        user:
          type: string
        project_id:
          type: string

    # Error schemas
    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              enum:
                - BAD_REQUEST
                - VALIDATION_FAILED
                - UNAUTHORIZED
                - FORBIDDEN
                - NOT_FOUND
                - CONFLICT
                - ACCOUNT_LOCKED
                - INTERNAL_ERROR
            message:
              type: string

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: BAD_REQUEST
              message: invalid request body

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: UNAUTHORIZED
              message: invalid or expired token

    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: FORBIDDEN
              message: access denied

    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: NOT_FOUND
              message: resource not found

    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: CONFLICT
              message: resource already exists

    AccountLocked:
      description: Account locked
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: ACCOUNT_LOCKED
              message: account temporarily locked due to too many failed attempts
